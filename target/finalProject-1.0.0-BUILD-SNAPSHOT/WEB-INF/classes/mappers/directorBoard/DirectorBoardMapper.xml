<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="DirectorBoardMapper">
	<!-- 글작성 -->
	<insert id="write" parameterType="directorBoardDTO">
		insert into directorboard
		(num, title, writer, contents, reg_date, hit, genre, curPrice, 
		targetPrice, state, targetDate, fname, oname, openDate) 
		values
		(directorboard_seq.nextval, #{title}, #{writer}, #{contents}, sysdate,
		0, #{genre}, 0, #{targetPrice}, 1, #{targetDate}, #{fname}, #{oname}, #{openDate})
	</insert>
	
	<!-- 리스트 뽑아오기 -->
	<select id="list" parameterType="java.util.Map" resultType="directorBoardDTO">
		select * from 
		(select rownum r, t.* from 
    	(select * from DIRECTORBOARD 
   			<where>
    		<foreach collection="genre" item="item">
    			<if test="kind=='genre'">
    				and genre like '%'||#{item}||'%'
    			</if>
	   			<if test="kind2=='state'">
	   				and state=#{state} 
	   			</if>
    		</foreach>
   			</where>
    	 order by num desc) t)
    	 where r between #{startRow} and #{lastRow}
	</select>
	
	<!-- view -->
	<select id="view" parameterType="int" resultType="directorBoardDTO">
		select * from DIRECTORBOARD where num=#{num}
	</select>	
	
	<!-- state update -->
	<update id="stateUpdate">
		update DIRECTORBOARD set state=0 where TARGETDATE <![CDATA[ < ]]> SYSDATE
	</update>
	
</mapper>